from django.shortcuts import render, redirectfrom django.http import HttpResponsefrom django.utils import timezonefrom django.db import connectionfrom .forms import CQHEISurveyForm# NOTE: CQHEISurvey intentionally NOT used hereimport csv# helper to normalize checkbox ‚Üí scoredef score(val):    return 2 if val else 0def survey_form(request):    if request.method == 'POST':        print("üî•üî•üî• SURVEY POST HIT UPDATED DJANGO CODE üî•üî•üî•")        form = CQHEISurveyForm(request.POST)        if form.is_valid():            # ============================            # Section II ‚Äì Fish Cover ONLY            # ============================            now = timezone.now()            # TEMP: isolate Section II only            # We are NOT saving survey data yet            survey_id = int(timezone.now().timestamp())            with connection.cursor() as cursor:                cursor.execute(                    """                    INSERT INTO cQHEI.Cover (                        cQHEI_New_X_ID,                        Underwater_Tree_Roots,                        Underwater_Tree_Rootlets,                        Boulders,                        Oxbows_Backwaters,                        Downed_trees,                        Shallows,                        Water_Plants,                        Deep_Pools,                        Overhanging_Vegetation,                        Undercut_Banks,                        Created_Timestamp,                        Last_Updated_Timestamp                    )                    OUTPUT INSERTED.Cover_Score                    VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)                    """,                    [                        survey_id,                        score(form.cleaned_data.get('cover_underwater_tree_roots_large')),                        score(form.cleaned_data.get('cover_underwater_tree_rootlets')),                        score(form.cleaned_data.get('cover_boulders')),                        score(form.cleaned_data.get('cover_backwaters')),                        score(form.cleaned_data.get('cover_downed_trees')),                        score(form.cleaned_data.get('cover_shallow_slow_areas')),                        score(form.cleaned_data.get('cover_water_plants')),                        score(form.cleaned_data.get('cover_deep_areas')),                        score(form.cleaned_data.get('cover_shrubs_small_trees')),                        score(form.cleaned_data.get('cover_undercut_banks')),                        now,                        now                    ]                )                section2_score = cursor.fetchone()[0]            print(f"üî• COVER SCORE RETURNED FROM SQL = {section2_score}")            # TEMP success redirect (no survey object)            return render(                request,                'success.html',                {                    'cover_score': section2_score                }            )        else:            print("‚ùå FORM INVALID")            print(form.errors)    else:        form = CQHEISurveyForm()    return render(        request,        'survey_form.html',        {            'form': form        }    )# BELOW VIEWS ARE LEFT UNCHANGED# They are NOT used in Section II isolation modedef survey_success(request, survey_id):    return HttpResponse("Survey integration not enabled yet.")def survey_list(request):    return HttpResponse("Survey list not enabled yet.")def export_surveys_csv(request):    response = HttpResponse(content_type='text/csv')    response['Content-Disposition'] = 'attachment; filename="cqhei_surveys.csv"'    writer = csv.writer(response)    writer.writerow(['Cover_Score'])    return response